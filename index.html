<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title> PONG: ARCADE EDITION</title>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

    body {
        margin: 0;
        background-color: #050505;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        overflow: hidden;
        font-family: 'Press Start 2P', cursive;
    }

    #game-container {
        position: relative;
        box-shadow: 0 0 50px rgba(0, 255, 255, 0.2);
        border: 4px solid #333;
        border-radius: 4px;
    }

    canvas {
        display: block;
        background: radial-gradient(circle at center, #1a1a1a, #000000);
    }

    .scanlines {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(
            to bottom,
            rgba(255,255,255,0),
            rgba(255,255,255,0) 50%,
            rgba(0,0,0,0.2) 50%,
            rgba(0,0,0,0.2)
        );
        background-size: 100% 4px;
        pointer-events: none;
        z-index: 10;
        box-shadow: inset 0 0 100px rgba(0,0,0,0.9);
    }

    #ui-layer {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 20;
        text-align: center;
        color: white;
        text-shadow: 4px 4px #ff00de;
    }

    .hidden { display: none !important; }
    
    h1 { 
        font-size: 40px; 
        margin-bottom: 30px; 
        color: #0ff; 
    }
    
    p { 
        font-size: 14px; 
        color: #aaa; 
        line-height: 1.5; 
    }
    
    .menu-section {
        margin: 15px 0;
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    
    label {
        font-size: 12px;
        color: #0ff;
        margin-bottom: 8px;
        text-shadow: 2px 2px #ff00de;
    }
    
    select {
        font-family: 'Press Start 2P', cursive;
        font-size: 12px;
        padding: 10px 20px;
        background-color: #1a1a1a;
        color: #0ff;
        border: 2px solid #0ff;
        border-radius: 4px;
        cursor: pointer;
        text-shadow: 0 0 5px #0ff;
        box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
    }
    
    select:hover {
        background-color: #2a2a2a;
        box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
    }
    
    select option {
        background-color: #1a1a1a;
        color: #0ff;
    }
    
    button {
        font-family: 'Press Start 2P', cursive;
        font-size: 14px;
        padding: 15px 30px;
        margin-top: 30px;
        background-color: #1a1a1a;
        color: #ff0;
        border: 3px solid #ff0;
        border-radius: 4px;
        cursor: pointer;
        text-shadow: 0 0 10px #ff0;
        box-shadow: 0 0 20px rgba(255, 255, 0, 0.4);
        transition: all 0.3s;
    }
    
    button:hover {
        background-color: #ff0;
        color: #000;
        transform: scale(1.05);
        box-shadow: 0 0 30px rgba(255, 255, 0, 0.8);
    }
    
    .blink { 
        animation: blinker 1s linear infinite; 
    }

    @keyframes blinker { 
        50% { opacity: 0; } 
    }
</style>
</head>
<body>

<div id="game-container">
    <canvas id="game" width="900" height="500"></canvas>
    <div class="scanlines"></div>
    
    <div id="ui-layer">
        
        <div id="menu-screen">
            <p style="margin-bottom: 20px;">W / S to Move â€¢ First to 10 Wins</p>
            
            <div class="menu-section">
                <label>DIFFICULTY:</label>
                <select id="difficulty">
                    <option value="easy">EASY</option>
                    <option value="medium" selected>MEDIUM</option>
                    <option value="hard">HARD</option>
                    <option value="impossible">IMPOSSIBLE</option>
                </select>
            </div>
            
            <div class="menu-section">
                <label>YOUR PADDLE:</label>
                <select id="paddle-color">
                    <option value="#0ff" selected>CYAN</option>
                    <option value="#0f0">GREEN</option>
                    <option value="#ff0">YELLOW</option>
                    <option value="#f0f">MAGENTA</option>
                    <option value="#00f">BLUE</option>
                    <option value="#f80">ORANGE</option>
                    <option value="#fff">WHITE</option>
                </select>
            </div>
            
            <div class="menu-section">
                <label>BALL COLOR:</label>
                <select id="ball-color">
                    <option value="#fff" selected>WHITE</option>
                    <option value="#0ff">CYAN</option>
                    <option value="#0f0">GREEN</option>
                    <option value="#ff0">YELLOW</option>
                    <option value="#f0f">MAGENTA</option>
                    <option value="#f00">RED</option>
                    <option value="#f80">ORANGE</option>
                </select>
            </div>
            
            <button id="start-btn" class="blink">START GAME</button>
        </div>
        
        <div id="gameover-screen" class="hidden"></div>
    </div>
</div>

<script>
/**
 * 1. SETUP & CONFIGURATION
 */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const uiLayer = document.getElementById("ui-layer");
const menuScreen = document.getElementById("menu-screen");
const gameoverScreen = document.getElementById("gameover-screen");
const startBtn = document.getElementById("start-btn");

const PADDLE_H = 80;
const PADDLE_W = 15;
const WIN_SCORE = 10;

// Colors (will be set from menu)
let COLOR_PLAYER = "#0ff";
let COLOR_AI = "#ff00de";
let COLOR_BALL = "#fff";

// Difficulty settings
let aiSpeed = 0.12;  // Default medium
let aiError = 20;    // Default medium

// Game State
let gameState = "MENU"; // MENU, PLAYING, GAMEOVER
let winnerText = "";
let shakeIntensity = 0;

/**
 * 2. AUDIO ENGINE (Web Audio API)
 */
const AudioContext = window.AudioContext || window.webkitAudioContext;
let audioCtx;

function initAudio() {
    if (!audioCtx) audioCtx = new AudioContext();
    if (audioCtx.state === 'suspended') audioCtx.resume();
}

function playSound(type) {
    if (!audioCtx) return;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.connect(gain);
    gain.connect(audioCtx.destination);

    const now = audioCtx.currentTime;

    if (type === "hit") {
        osc.type = "square";
        osc.frequency.setValueAtTime(400, now);
        osc.frequency.exponentialRampToValueAtTime(800, now + 0.1);
        gain.gain.setValueAtTime(0.1, now);
        gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
        osc.start(now);
        osc.stop(now + 0.1);
    } else if (type === "wall") {
        osc.type = "sine";
        osc.frequency.setValueAtTime(150, now);
        osc.frequency.linearRampToValueAtTime(100, now + 0.1);
        gain.gain.setValueAtTime(0.1, now);
        gain.gain.linearRampToValueAtTime(0.01, now + 0.1);
        osc.start(now);
        osc.stop(now + 0.1);
    } else if (type === "score") {
        osc.type = "triangle";
        osc.frequency.setValueAtTime(200, now);
        osc.frequency.linearRampToValueAtTime(600, now + 0.2);
        gain.gain.setValueAtTime(0.1, now);
        gain.gain.linearRampToValueAtTime(0.01, now + 0.4);
        osc.start(now);
        osc.stop(now + 0.4);
    }
}

/**
 * 3. GAME OBJECTS
 */

// Particles for explosions
let particles = [];
class Particle {
    constructor(x, y, color) {
        this.x = x;
        this.y = y;
        this.size = Math.random() * 5 + 2;
        this.speedX = Math.random() * 6 - 3;
        this.speedY = Math.random() * 6 - 3;
        this.color = color;
        this.life = 1.0;
    }
    update() {
        this.x += this.speedX;
        this.y += this.speedY;
        this.life -= 0.03;
        this.size *= 0.95;
    }
    draw() {
        ctx.fillStyle = this.color;
        ctx.globalAlpha = this.life;
        ctx.fillRect(this.x, this.y, this.size, this.size);
        ctx.globalAlpha = 1.0;
    }
}

// Ball Trail
let trail = [];

let player = { x: 20, y: 200, score: 0, color: COLOR_PLAYER };
let ai = { x: canvas.width - 35, y: 200, score: 0, color: COLOR_AI };
let ball = { x: 450, y: 250, dx: 5, dy: 3, r: 8, speed: 7 };

const keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

/**
 * 4. MENU LOGIC
 */
startBtn.addEventListener("click", () => {
    initAudio();
    
    // Get difficulty settings
    const difficulty = document.getElementById("difficulty").value;
    switch(difficulty) {
        case "easy":
            aiSpeed = 0.08;
            aiError = 35;
            break;
        case "medium":
            aiSpeed = 0.12;
            aiError = 20;
            break;
        case "hard":
            aiSpeed = 0.20;
            aiError = 10;
            break;
        case "impossible":
            aiSpeed = 0.30;
            aiError = 3;
            break;
    }
    
    // Get color settings
    COLOR_PLAYER = document.getElementById("paddle-color").value;
    COLOR_BALL = document.getElementById("ball-color").value;
    
    // Update player color
    player.color = COLOR_PLAYER;
    
    // Start game
    resetGame();
    gameState = "PLAYING";
    menuScreen.classList.add("hidden");
});

// Touch controls
canvas.addEventListener("touchmove", e => {
    e.preventDefault();
    let rect = canvas.getBoundingClientRect();
    let y = e.touches[0].clientY - rect.top;
    player.y = y - PADDLE_H / 2;
}, { passive: false });

/**
 * 5. GAME LOGIC
 */

function spawnParticles(x, y, color) {
    for (let i = 0; i < 15; i++) {
        particles.push(new Particle(x, y, color));
    }
}

function resetBall() {
    ball.x = canvas.width / 2;
    ball.y = canvas.height / 2;
    ball.speed = 7;
    ball.dx = (Math.random() > 0.5 ? 1 : -1) * ball.speed;
    ball.dy = (Math.random() * 6) - 3;
    trail = [];
}

function resetGame() {
    player.score = 0;
    ai.score = 0;
    resetBall();
}

function update() {
    if (gameState !== "PLAYING") return;

    // Player Movement
    if (keys["w"] && player.y > 0) player.y -= 8;
    if (keys["s"] && player.y < canvas.height - PADDLE_H) player.y += 8;

    // AI Movement (uses difficulty settings)
    let targetY = ball.y - PADDLE_H / 2;
    let error = (Math.random() - 0.5) * aiError;
    ai.y += (targetY + error - ai.y) * aiSpeed;
    
    // Clamp AI
    if(ai.y < 0) ai.y = 0;
    if(ai.y > canvas.height - PADDLE_H) ai.y = canvas.height - PADDLE_H;

    // Ball Physics
    ball.x += ball.dx;
    ball.y += ball.dy;

    // Trail logic
    trail.push({x: ball.x, y: ball.y});
    if(trail.length > 20) trail.shift();

    // Wall Collisions
    if (ball.y - ball.r <= 0 || ball.y + ball.r >= canvas.height) {
        ball.dy *= -1;
        playSound("wall");
        shakeIntensity = 5;
    }

    // Paddle Collisions
    function checkCollision(paddle) {
        return ball.x - ball.r < paddle.x + PADDLE_W &&
               ball.x + ball.r > paddle.x &&
               ball.y > paddle.y &&
               ball.y < paddle.y + PADDLE_H;
    }

    // Player Hit
    if (checkCollision(player)) {
        let collidePoint = (ball.y - (player.y + PADDLE_H / 2));
        collidePoint = collidePoint / (PADDLE_H / 2);
        
        ball.speed = Math.min(ball.speed * 1.05, 18); 
        
        let angleRad = (Math.PI / 4) * collidePoint;
        let direction = (ball.x < canvas.width / 2) ? 1 : -1;
        
        ball.dx = direction * ball.speed * Math.cos(angleRad);
        ball.dy = ball.speed * Math.sin(angleRad);
        
        ball.x = player.x + PADDLE_W + ball.r + 1;

        playSound("hit");
        spawnParticles(ball.x, ball.y, COLOR_PLAYER);
        shakeIntensity = 10;
    }

    // AI Hit
    if (checkCollision(ai)) {
        let collidePoint = (ball.y - (ai.y + PADDLE_H / 2));
        collidePoint = collidePoint / (PADDLE_H / 2);
        
        ball.speed = Math.min(ball.speed * 1.05, 18);

        let angleRad = (Math.PI / 4) * collidePoint;
        let direction = (ball.x < canvas.width / 2) ? 1 : -1;
        
        ball.dx = direction * ball.speed * Math.cos(angleRad);
        ball.dy = ball.speed * Math.sin(angleRad);

        ball.x = ai.x - ball.r - 1;

        playSound("hit");
        spawnParticles(ball.x, ball.y, COLOR_AI);
        shakeIntensity = 10;
    }

    // Scoring
    if (ball.x < 0) {
        ai.score++;
        checkWin();
        playSound("score");
        resetBall();
    }
    if (ball.x > canvas.width) {
        player.score++;
        checkWin();
        playSound("score");
        resetBall();
    }

    // Particles & Shake Update
    particles.forEach((p, index) => {
        p.update();
        if (p.life <= 0) particles.splice(index, 1);
    });

    if (shakeIntensity > 0) shakeIntensity *= 0.9;
    if (shakeIntensity < 0.5) shakeIntensity = 0;
}

function checkWin() {
    if (player.score >= WIN_SCORE || ai.score >= WIN_SCORE) {
        gameState = "GAMEOVER";
        winnerText = player.score >= WIN_SCORE ? "YOU WIN" : "GAME OVER";
        
        gameoverScreen.innerHTML = `
            <h1 style="color:${player.score >= WIN_SCORE ? '#0f0' : '#f00'}; text-shadow: 4px 4px ${player.score >= WIN_SCORE ? '#0a0' : '#a00'}">${winnerText}</h1>
            <p style="font-size: 16px; margin: 20px 0;">Score: ${player.score} - ${ai.score}</p>
            <button id="play-again-btn" class="blink">PLAY AGAIN</button>
        `;
        
        gameoverScreen.classList.remove("hidden");
        
        // Add event listener to play again button
        document.getElementById("play-again-btn").addEventListener("click", () => {
            gameoverScreen.classList.add("hidden");
            menuScreen.classList.remove("hidden");
            gameState = "MENU";
        });
    }
}

/**
 * 6. RENDERING
 */

function drawNet() {
    ctx.beginPath();
    ctx.setLineDash([10, 15]);
    ctx.lineWidth = 4;
    ctx.strokeStyle = "#333";
    ctx.moveTo(canvas.width / 2, 0);
    ctx.lineTo(canvas.width / 2, canvas.height);
    ctx.stroke();
    ctx.setLineDash([]);
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Apply Screen Shake
    ctx.save();
    if (shakeIntensity > 0) {
        let dx = (Math.random() - 0.5) * shakeIntensity;
        let dy = (Math.random() - 0.5) * shakeIntensity;
        ctx.translate(dx, dy);
    }

    drawNet();

    // Draw Trail
    for (let i = 0; i < trail.length; i++) {
        let pos = trail[i];
        let ratio = (i + 1) / trail.length;
        ctx.beginPath();
        ctx.arc(pos.x, pos.y, ball.r * ratio, 0, Math.PI * 2);
        ctx.fillStyle = COLOR_BALL.replace('#', 'rgba(') + ratio * 0.5 + ')';
        // Convert hex to rgba for trail opacity
        let r = parseInt(COLOR_BALL.slice(1,3), 16);
        let g = parseInt(COLOR_BALL.slice(3,5), 16);
        let b = parseInt(COLOR_BALL.slice(5,7), 16);
        ctx.fillStyle = `rgba(${r}, ${g}, ${b}, ${ratio * 0.5})`;
        ctx.fill();
    }

    // Draw Particles
    particles.forEach(p => p.draw());

    // Draw Player
    ctx.shadowBlur = 20;
    ctx.shadowColor = COLOR_PLAYER;
    ctx.fillStyle = COLOR_PLAYER;
    ctx.fillRect(player.x, player.y, PADDLE_W, PADDLE_H);

    // Draw AI
    ctx.shadowColor = COLOR_AI;
    ctx.fillStyle = COLOR_AI;
    ctx.fillRect(ai.x, ai.y, PADDLE_W, PADDLE_H);

    // Draw Ball
    ctx.shadowBlur = 15;
    ctx.shadowColor = COLOR_BALL;
    ctx.fillStyle = COLOR_BALL;
    ctx.beginPath();
    ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI * 2);
    ctx.fill();

    // Reset Shadows for Score
    ctx.shadowBlur = 0;
    ctx.restore();

    // Draw Score
    ctx.font = "60px 'Press Start 2P'";
    ctx.fillStyle = "rgba(255, 255, 255, 0.1)";
    ctx.textAlign = "center";
    ctx.fillText(player.score, canvas.width / 4, canvas.height / 2 + 20);
    ctx.fillText(ai.score, canvas.width * 0.75, canvas.height / 2 + 20);
}

function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
}

loop();

</script>

</body>
</html>
