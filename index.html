<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NEON PONG: ARCADE EDITION</title>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

    body {
        margin: 0;
        background-color: #050505;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        overflow: hidden;
        font-family: 'Press Start 2P', cursive; /* Retro Gaming Font */
    }

    /* The Game Container */
    #game-container {
        position: relative;
        box-shadow: 0 0 50px rgba(0, 255, 255, 0.2);
        border: 4px solid #333;
        border-radius: 4px;
    }

    canvas {
        display: block;
        background: radial-gradient(circle at center, #1a1a1a, #000000);
    }

    /* CRT Scanline Effect Overlay */
    .scanlines {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(
            to bottom,
            rgba(255,255,255,0),
            rgba(255,255,255,0) 50%,
            rgba(0,0,0,0.2) 50%,
            rgba(0,0,0,0.2)
        );
        background-size: 100% 4px;
        pointer-events: none;
        z-index: 10;
        box-shadow: inset 0 0 100px rgba(0,0,0,0.9);
    }

    /* UI Overlay for Start/Game Over */
    #ui-layer {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 20;
        text-align: center;
        color: white;
        text-shadow: 4px 4px #ff00de;
    }

    .hidden { display: none !important; }
    
    h1 { font-size: 40px; margin-bottom: 20px; color: #0ff; }
    p { font-size: 14px; color: #aaa; line-height: 1.5; }
    .blink { animation: blinker 1s linear infinite; color: #ff0; margin-top: 30px;}

    @keyframes blinker { 50% { opacity: 0; } }
</style>
</head>
<body>

<div id="game-container">
    <canvas id="game" width="900" height="500"></canvas>
    <div class="scanlines"></div>
    
    <div id="ui-layer">
        <h1>NEON PONG</h1>
        <p>W / S to Move</p>
        <p>First to 10 Wins</p>
        <div class="blink">CLICK TO START</div>
    </div>
</div>

<script>
/**
 * 1. SETUP & CONFIGURATION
 */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const uiLayer = document.getElementById("ui-layer");

const PADDLE_H = 80;
const PADDLE_W = 15;
const WIN_SCORE = 10;

// Colors
const COLOR_PLAYER = "#0ff"; // Cyan
const COLOR_AI = "#ff00de";  // Hot Pink
const COLOR_BALL = "#fff";

// Game State
let gameState = "MENU"; // MENU, PLAYING, GAMEOVER
let winnerText = "";
let shakeIntensity = 0;

/**
 * 2. AUDIO ENGINE (Web Audio API)
 * No external files needed. We synthesize sounds.
 */
const AudioContext = window.AudioContext || window.webkitAudioContext;
let audioCtx;

function initAudio() {
    if (!audioCtx) audioCtx = new AudioContext();
    if (audioCtx.state === 'suspended') audioCtx.resume();
}

function playSound(type) {
    if (!audioCtx) return;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.connect(gain);
    gain.connect(audioCtx.destination);

    const now = audioCtx.currentTime;

    if (type === "hit") {
        // Paddle Hit: High blip
        osc.type = "square";
        osc.frequency.setValueAtTime(400, now);
        osc.frequency.exponentialRampToValueAtTime(800, now + 0.1);
        gain.gain.setValueAtTime(0.1, now);
        gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
        osc.start(now);
        osc.stop(now + 0.1);
    } else if (type === "wall") {
        // Wall Hit: Low thud
        osc.type = "sine";
        osc.frequency.setValueAtTime(150, now);
        osc.frequency.linearRampToValueAtTime(100, now + 0.1);
        gain.gain.setValueAtTime(0.1, now);
        gain.gain.linearRampToValueAtTime(0.01, now + 0.1);
        osc.start(now);
        osc.stop(now + 0.1);
    } else if (type === "score") {
        // Score: Retro powerup sound
        osc.type = "triangle";
        osc.frequency.setValueAtTime(200, now);
        osc.frequency.linearRampToValueAtTime(600, now + 0.2);
        gain.gain.setValueAtTime(0.1, now);
        gain.gain.linearRampToValueAtTime(0.01, now + 0.4);
        osc.start(now);
        osc.stop(now + 0.4);
    }
}

/**
 * 3. GAME OBJECTS
 */

// Particles for explosions
let particles = [];
class Particle {
    constructor(x, y, color) {
        this.x = x;
        this.y = y;
        this.size = Math.random() * 5 + 2;
        this.speedX = Math.random() * 6 - 3;
        this.speedY = Math.random() * 6 - 3;
        this.color = color;
        this.life = 1.0; // Opacity
    }
    update() {
        this.x += this.speedX;
        this.y += this.speedY;
        this.life -= 0.03;
        this.size *= 0.95;
    }
    draw() {
        ctx.fillStyle = this.color;
        ctx.globalAlpha = this.life;
        ctx.fillRect(this.x, this.y, this.size, this.size);
        ctx.globalAlpha = 1.0;
    }
}

// Ball Trail
let trail = [];

let player = { x: 20, y: 200, score: 0, color: COLOR_PLAYER };
let ai = { x: canvas.width - 35, y: 200, score: 0, color: COLOR_AI };
let ball = { x: 450, y: 250, dx: 5, dy: 3, r: 8, speed: 7 };

const keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

// Start game on click (required for Audio Context)
document.addEventListener("click", () => {
    if (gameState === "MENU" || gameState === "GAMEOVER") {
        initAudio();
        resetGame();
        gameState = "PLAYING";
        uiLayer.classList.add("hidden");
    }
});

// Touch controls
canvas.addEventListener("touchmove", e => {
    e.preventDefault(); // Stop scrolling
    let rect = canvas.getBoundingClientRect();
    let y = e.touches[0].clientY - rect.top;
    player.y = y - PADDLE_H / 2;
}, { passive: false });

/**
 * 4. LOGIC
 */

function spawnParticles(x, y, color) {
    for (let i = 0; i < 15; i++) {
        particles.push(new Particle(x, y, color));
    }
}

function resetBall() {
    ball.x = canvas.width / 2;
    ball.y = canvas.height / 2;
    ball.speed = 7; // Reset speed
    // Random launch direction
    ball.dx = (Math.random() > 0.5 ? 1 : -1) * ball.speed;
    ball.dy = (Math.random() * 6) - 3;
    trail = [];
}

function resetGame() {
    player.score = 0;
    ai.score = 0;
    resetBall();
}

function update() {
    if (gameState !== "PLAYING") return;

    // --- Player Movement ---
    if (keys["w"] && player.y > 0) player.y -= 8;
    if (keys["s"] && player.y < canvas.height - PADDLE_H) player.y += 8;

    // --- AI Movement (HARDER DIFFICULTY) ---
    // AI aims for the ball with better prediction
    let targetY = ball.y - PADDLE_H / 2;
    // Reduced error for harder difficulty (was 30, now 10)
    let error = (Math.random() - 0.5) * 10; 
    
    // Lerp: Move 20% of the way to the target per frame (was 9%, now 20% - much faster!)
    ai.y += (targetY + error - ai.y) * 0.20;
    
    // Clamp AI
    if(ai.y < 0) ai.y = 0;
    if(ai.y > canvas.height - PADDLE_H) ai.y = canvas.height - PADDLE_H;

    // --- Ball Physics ---
    ball.x += ball.dx;
    ball.y += ball.dy;

    // Trail logic
    trail.push({x: ball.x, y: ball.y});
    if(trail.length > 20) trail.shift();

    // Wall Collisions
    if (ball.y - ball.r <= 0 || ball.y + ball.r >= canvas.height) {
        ball.dy *= -1;
        playSound("wall");
        shakeIntensity = 5;
    }

    // --- Paddle Collisions ---
    function checkCollision(paddle) {
        return ball.x - ball.r < paddle.x + PADDLE_W &&
               ball.x + ball.r > paddle.x &&
               ball.y > paddle.y &&
               ball.y < paddle.y + PADDLE_H;
    }

    // Player Hit
    if (checkCollision(player)) {
        let collidePoint = (ball.y - (player.y + PADDLE_H / 2));
        collidePoint = collidePoint / (PADDLE_H / 2);
        
        // Speed up ball slightly every hit (Arcade intensity!)
        ball.speed = Math.min(ball.speed * 1.05, 18); 
        
        let angleRad = (Math.PI / 4) * collidePoint;
        let direction = (ball.x < canvas.width / 2) ? 1 : -1;
        
        ball.dx = direction * ball.speed * Math.cos(angleRad);
        ball.dy = ball.speed * Math.sin(angleRad);
        
        // Push ball out of paddle to prevent sticking
        ball.x = player.x + PADDLE_W + ball.r + 1;

        playSound("hit");
        spawnParticles(ball.x, ball.y, COLOR_PLAYER);
        shakeIntensity = 10;
    }

    // AI Hit
    if (checkCollision(ai)) {
        let collidePoint = (ball.y - (ai.y + PADDLE_H / 2));
        collidePoint = collidePoint / (PADDLE_H / 2);
        
        ball.speed = Math.min(ball.speed * 1.05, 18);

        let angleRad = (Math.PI / 4) * collidePoint;
        let direction = (ball.x < canvas.width / 2) ? 1 : -1;
        
        ball.dx = direction * ball.speed * Math.cos(angleRad);
        ball.dy = ball.speed * Math.sin(angleRad);

        // Push ball out
        ball.x = ai.x - ball.r - 1;

        playSound("hit");
        spawnParticles(ball.x, ball.y, COLOR_AI);
        shakeIntensity = 10;
    }

    // --- Scoring ---
    if (ball.x < 0) {
        ai.score++;
        checkWin();
        playSound("score");
        resetBall();
    }
    if (ball.x > canvas.width) {
        player.score++;
        checkWin();
        playSound("score");
        resetBall();
    }

    // --- Particles & Shake Update ---
    particles.forEach((p, index) => {
        p.update();
        if (p.life <= 0) particles.splice(index, 1);
    });

    if (shakeIntensity > 0) shakeIntensity *= 0.9;
    if (shakeIntensity < 0.5) shakeIntensity = 0;
}

function checkWin() {
    if (player.score >= WIN_SCORE || ai.score >= WIN_SCORE) {
        gameState = "GAMEOVER";
        winnerText = player.score >= WIN_SCORE ? "YOU WIN" : "GAME OVER";
        uiLayer.innerHTML = `
            <h1 style="color:${player.score >= WIN_SCORE ? '#0f0' : '#f00'}">${winnerText}</h1>
            <p>Score: ${player.score} - ${ai.score}</p>
            <div class="blink">CLICK TO PLAY AGAIN</div>
        `;
        uiLayer.classList.remove("hidden");
    }
}

/**
 * 5. RENDERING
 */

function drawNet() {
    ctx.beginPath();
    ctx.setLineDash([10, 15]);
    ctx.lineWidth = 4;
    ctx.strokeStyle = "#333";
    ctx.moveTo(canvas.width / 2, 0);
    ctx.lineTo(canvas.width / 2, canvas.height);
    ctx.stroke();
    ctx.setLineDash([]);
}

function draw() {
    // Fill background with opacity for trail effect if desired, 
    // but here we clear cleanly for crisp fps.
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Apply Screen Shake
    ctx.save();
    if (shakeIntensity > 0) {
        let dx = (Math.random() - 0.5) * shakeIntensity;
        let dy = (Math.random() - 0.5) * shakeIntensity;
        ctx.translate(dx, dy);
    }

    drawNet();

    // Draw Trail
    for (let i = 0; i < trail.length; i++) {
        let pos = trail[i];
        let ratio = (i + 1) / trail.length;
        ctx.beginPath();
        ctx.arc(pos.x, pos.y, ball.r * ratio, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(255, 255, 255, ${ratio * 0.5})`;
        ctx.fill();
    }

    // Draw Particles
    particles.forEach(p => p.draw());

    // Draw Player
    ctx.shadowBlur = 20;
    ctx.shadowColor = COLOR_PLAYER;
    ctx.fillStyle = COLOR_PLAYER;
    ctx.fillRect(player.x, player.y, PADDLE_W, PADDLE_H);

    // Draw AI
    ctx.shadowColor = COLOR_AI;
    ctx.fillStyle = COLOR_AI;
    ctx.fillRect(ai.x, ai.y, PADDLE_W, PADDLE_H);

    // Draw Ball
    ctx.shadowBlur = 15;
    ctx.shadowColor = "#fff";
    ctx.fillStyle = "#fff";
    ctx.beginPath();
    ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI * 2);
    ctx.fill();

    // Reset Shadows for Score
    ctx.shadowBlur = 0;
    ctx.restore();

    // Draw Score (Background HUD style)
    ctx.font = "60px 'Press Start 2P'";
    ctx.fillStyle = "rgba(255, 255, 255, 0.1)";
    ctx.textAlign = "center";
    ctx.fillText(player.score, canvas.width / 4, canvas.height / 2 + 20);
    ctx.fillText(ai.score, canvas.width * 0.75, canvas.height / 2 + 20);
}

function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
}

loop();

</script>

</body>
</html>
